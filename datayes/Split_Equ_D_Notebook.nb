import pandas as pd
# df = DataAPI.EquGet(ticker=u"",ticker=u"000001", equTypeCD=u"A",listStatusCD=u"",exchangeCD="",ListSectorCD=u"",field=u"",pandas="1")

# df.to_csv("equity_all.csv",encoding="gbk")
df_secid=DataAPI.EquGet(equTypeCD=u"A",listStatusCD=u"",exchangeCD="XSHG",ListSectorCD=u"",field=u"secID",pandas="1")
# df_secid=DataAPI.EquGet(secID="000001.XSHE,000002.XSHE,000003.XSHE", equTypeCD=u"A",listStatusCD=u"",exchangeCD="XSHE",ListSectorCD=u"",field=u"secID",pandas="1")

# print type(df_secid['secID'])
count=15
sizeCount=0
logdata=""
need_header=True
is_exist=True
for secID in df_secid['secID']:
    
    # if secID=="300681.XSHE":
    #     is_exist=False
    # if is_exist:
    #     continue
        
    df_equ_d=DataAPI.MktEqudGet(secID=secID,beginDate=u"19900101",endDate=u"20220201",isOpen="",field=u"",pandas="1")
    df_adj_af_factor=DataAPI.MktEqudAdjAfGet(secID=secID,beginDate=u"19900101",endDate=u"20220201",isOpen="",field=u"accumAdjFactor",pandas="1")
    # df_adj_af_factor.rename(columns={'accumAdjFactor':'accumAdjAfFactor'})
    df_adj_af_factor.columns=['accumAdjAfFactor']    
    # print df_adj_af_factor
    df_fixed=pd.concat([df_equ_d,df_adj_af_factor], axis=1)
    output_filename="equ_d_" + str(count) + ".csv"
    if sizeCount==0:
        print ("Write to new file "+ output_filename + ", Start secID:" + secID +"")
        
    sizeCount=sizeCount+df_fixed.size
       
    if sizeCount >13000000:
        print ("Size is about 100M, Start to new file since secID: " + secID)
        count=count+1
        need_header=True        
        #reset sizeCount
        sizeCount=0        
    # print df_fixed    
    output_filename="equ_d_" + str(count) + ".csv"
    df_fixed.to_csv(output_filename, mode='a', header=need_header,encoding="gbk")
    #reset needHeader
    need_header=False

print sizeCount
